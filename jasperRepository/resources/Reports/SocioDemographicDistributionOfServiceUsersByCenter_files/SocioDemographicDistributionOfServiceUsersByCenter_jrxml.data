<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="socioDemographic_center" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="fcfcb073-bab2-4c9b-bb41-ddf907675a82">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<style name="Crosstab Data Text" hAlign="Center"/>
	<parameter name="from_date" class="java.util.Date"/>
	<parameter name="to_date" class="java.util.Date"/>
	<parameter name="center" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT  distinct foo.person_id,
       gender,
       IF(age>=0 && age<15, '0-14',
		IF(age>14 && age<25, '15-24',
		IF(age>24 && age<35, '25-34',
		IF(age>34 && age<45, '35-44',
		IF(age>44 && age<55, '45-54',
		IF(age>54 && age<65, '55-64',
		IF(age>64, '64+', 'other'))))))) AS ageGroup
from
	(SELECT p.person_id, birthdate, (YEAR(CURDATE())-YEAR(birthdate)) - (RIGHT(CURDATE(),5) < RIGHT(birthdate,5)) AS age, gender
	  FROM person p
	  join person_address pa on pa.person_id = p.person_id
	  WHERE gender IN ('M','F')
	) AS foo
JOIN encounter e ON e.patient_id = foo.person_id
JOIN location l ON l.location_id = e.location_id
WHERE e.encounter_datetime BETWEEN $P{from_date} AND $P{to_date}
and l.name = $P{center};]]>
	</queryString>
	<field name="person_id" class="java.lang.Integer">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="gender" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="ageGroup" class="java.lang.String"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="86" splitType="Stretch">
			<frame>
				<reportElement uuid="aebdb54f-c93d-49c9-9341-d9ba959963b1" mode="Opaque" x="0" y="0" width="555" height="85" backcolor="#006699"/>
				<staticText>
					<reportElement uuid="4a9628e3-67e2-4896-ac65-66bdba4af2eb" x="10" y="20" width="545" height="43" forecolor="#FFFFFF"/>
					<textElement verticalAlignment="Middle">
						<font size="24" isBold="true"/>
					</textElement>
					<text><![CDATA[Socio Demographic Report]]></text>
				</staticText>
				<textField>
					<reportElement uuid="10e8080a-99c6-4134-a2c0-968adf3e41b5" x="20" y="63" width="535" height="20" forecolor="#FFFFFF"/>
					<textElement verticalAlignment="Middle">
						<font size="12"/>
					</textElement>
					<textFieldExpression><![CDATA["For Date range "+$P{from_date}+" - "+$P{to_date}]]></textFieldExpression>
				</textField>
			</frame>
		</band>
	</title>
	<summary>
		<band height="78" splitType="Stretch">
			<crosstab>
				<reportElement uuid="5128c4f2-63bf-4860-b42c-642e7262065d" x="0" y="0" width="555" height="78"/>
				<rowGroup name="ageGroup" width="70" totalPosition="End">
					<bucket class="java.lang.String">
						<bucketExpression><![CDATA[$F{ageGroup}]]></bucketExpression>
					</bucket>
					<crosstabRowHeader>
						<cellContents backcolor="#BFE1FF" mode="Opaque">
							<box>
								<pen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
							</box>
							<textField>
								<reportElement uuid="c5fe4239-64e3-44a4-9e5d-c906a4ba6fa0" style="Crosstab Data Text" x="0" y="0" width="70" height="25"/>
								<textElement/>
								<textFieldExpression><![CDATA[$V{ageGroup}]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabRowHeader>
					<crosstabTotalRowHeader>
						<cellContents backcolor="#E6F3FF" mode="Opaque">
							<box>
								<pen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
							</box>
							<staticText>
								<reportElement uuid="c4b11e5c-90db-4e00-a4e2-ef239fadeed3" x="0" y="0" width="70" height="25"/>
								<textElement textAlignment="Center" verticalAlignment="Middle"/>
								<text><![CDATA[Total ageGroup]]></text>
							</staticText>
						</cellContents>
					</crosstabTotalRowHeader>
				</rowGroup>
				<columnGroup name="gender" height="30" totalPosition="End">
					<bucket class="java.lang.String">
						<bucketExpression><![CDATA[$F{gender}]]></bucketExpression>
					</bucket>
					<crosstabColumnHeader>
						<cellContents backcolor="#BFE1FF" mode="Opaque">
							<box>
								<pen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
							</box>
							<textField>
								<reportElement uuid="416103b8-515d-4599-8b4d-7597b78c0b0d" style="Crosstab Data Text" x="0" y="0" width="50" height="30"/>
								<textElement/>
								<textFieldExpression><![CDATA[$V{gender}]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabColumnHeader>
					<crosstabTotalColumnHeader>
						<cellContents backcolor="#E6F3FF" mode="Opaque">
							<box>
								<pen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
							</box>
							<staticText>
								<reportElement uuid="73c25e26-54dc-4482-8c03-9b2651d05017" x="0" y="0" width="50" height="30"/>
								<textElement textAlignment="Center" verticalAlignment="Middle"/>
								<text><![CDATA[Total gender]]></text>
							</staticText>
						</cellContents>
					</crosstabTotalColumnHeader>
				</columnGroup>
				<measure name="ageGroupMeasure" class="java.lang.Integer" calculation="Count">
					<measureExpression><![CDATA[$F{ageGroup}]]></measureExpression>
				</measure>
				<crosstabCell width="50" height="25">
					<cellContents>
						<box>
							<pen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
						</box>
						<textField>
							<reportElement uuid="6c9dcf8a-028b-4e2e-bc38-50aede93cc90" style="Crosstab Data Text" x="0" y="0" width="50" height="25"/>
							<textElement/>
							<textFieldExpression><![CDATA[$V{ageGroupMeasure}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell height="25" rowTotalGroup="ageGroup">
					<cellContents backcolor="#E6F3FF" mode="Opaque">
						<box>
							<pen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
						</box>
						<textField>
							<reportElement uuid="97b079b9-c270-467b-a67e-e5287cf022e0" style="Crosstab Data Text" x="0" y="0" width="50" height="25"/>
							<textElement/>
							<textFieldExpression><![CDATA[$V{ageGroupMeasure}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="50" columnTotalGroup="gender">
					<cellContents backcolor="#E6F3FF" mode="Opaque">
						<box>
							<pen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
						</box>
						<textField>
							<reportElement uuid="a018b518-96db-45ad-b919-439edd939e27" style="Crosstab Data Text" x="0" y="0" width="50" height="25"/>
							<textElement/>
							<textFieldExpression><![CDATA[$V{ageGroupMeasure}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell rowTotalGroup="ageGroup" columnTotalGroup="gender">
					<cellContents backcolor="#E6F3FF" mode="Opaque">
						<box>
							<pen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
						</box>
						<textField>
							<reportElement uuid="0a47264f-143e-4ee8-9d3e-89644f2262f9" style="Crosstab Data Text" x="0" y="0" width="50" height="25"/>
							<textElement/>
							<textFieldExpression><![CDATA[$V{ageGroupMeasure}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
			</crosstab>
		</band>
	</summary>
</jasperReport>
