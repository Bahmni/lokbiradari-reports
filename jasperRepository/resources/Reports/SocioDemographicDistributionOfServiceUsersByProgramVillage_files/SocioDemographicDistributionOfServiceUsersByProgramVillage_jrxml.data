<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="socioreport_programvillage" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="6eaf93df-0435-482d-9bea-bab519ac192e">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<style name="Crosstab Data Text" hAlign="Center"/>
	<parameter name="from_date" class="java.util.Date"/>
	<parameter name="to_date" class="java.util.Date"/>
	<parameter name="program_village" class="java.lang.String">
		<defaultValueExpression><![CDATA[$F{city_village}]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT  distinct foo.person_id,
       gender,
       IF(age>=0 && age<15, '0-14',
		IF(age>14 && age<25, '15-24',
		IF(age>24 && age<35, '25-34',
		IF(age>34 && age<45, '35-44',
		IF(age>44 && age<55, '45-54',
		IF(age>54 && age<65, '55-64',
		IF(age>64, '64+', 'other'))))))) AS ageGroup,
		city_village
from
	(SELECT p.person_id, birthdate, (YEAR(CURDATE())-YEAR(birthdate)) - (RIGHT(CURDATE(),5) < RIGHT(birthdate,5)) AS age, gender, pa.city_village
	  FROM person p
	  join person_address pa on pa.person_id = p.person_id
	  join jss_program_village pv on pv.city_village= pa.city_village
	  WHERE gender IN ('M','F') AND pv.jss_program_village=$P{program_village}
	) AS foo
JOIN encounter e ON e.patient_id = foo.person_id
WHERE e.encounter_datetime BETWEEN $P{from_date} AND $P{to_date};]]>
	</queryString>
	<field name="person_id" class="java.lang.Integer">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="gender" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="ageGroup" class="java.lang.String"/>
	<field name="city_village" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="85" splitType="Stretch">
			<frame>
				<reportElement uuid="ea20985a-d647-4b0e-b9bb-4575ae6af229" mode="Opaque" x="0" y="0" width="555" height="85" backcolor="#006699"/>
				<staticText>
					<reportElement uuid="a53e5afb-beda-4821-a2a5-de2878040151" x="10" y="20" width="545" height="43" forecolor="#FFFFFF"/>
					<textElement verticalAlignment="Middle">
						<font size="24" isBold="true"/>
					</textElement>
					<text><![CDATA[Socio Demographic Report]]></text>
				</staticText>
				<textField>
					<reportElement uuid="19ea4856-29e5-474a-b8d8-db26e62b1870" x="20" y="63" width="535" height="20" forecolor="#FFFFFF"/>
					<textElement verticalAlignment="Middle">
						<font size="12"/>
					</textElement>
					<textFieldExpression><![CDATA["For Date range "+$P{from_date}+" - "+$P{to_date}]]></textFieldExpression>
				</textField>
			</frame>
		</band>
	</title>
	<summary>
		<band height="42" splitType="Stretch">
			<crosstab>
				<reportElement uuid="840cd2fb-47e4-48cb-8a7c-348e64f08c12" x="0" y="0" width="555" height="42"/>
				<rowGroup name="ageGroup" width="70" totalPosition="End">
					<bucket class="java.lang.String">
						<bucketExpression><![CDATA[$F{ageGroup}]]></bucketExpression>
					</bucket>
					<crosstabRowHeader>
						<cellContents backcolor="#F0F8FF" mode="Opaque">
							<box>
								<pen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
							</box>
							<textField>
								<reportElement uuid="99555add-b2e8-413c-b18c-7174490a5f9c" style="Crosstab Data Text" x="0" y="0" width="70" height="25"/>
								<textElement/>
								<textFieldExpression><![CDATA[$V{ageGroup}]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabRowHeader>
					<crosstabTotalRowHeader>
						<cellContents backcolor="#BFE1FF" mode="Opaque">
							<box>
								<pen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
							</box>
							<staticText>
								<reportElement uuid="287b28cd-ad84-450b-aea8-7535a2f4d350" x="0" y="0" width="70" height="25"/>
								<textElement textAlignment="Center" verticalAlignment="Middle"/>
								<text><![CDATA[Total ageGroup]]></text>
							</staticText>
						</cellContents>
					</crosstabTotalRowHeader>
				</rowGroup>
				<columnGroup name="gender" height="30" totalPosition="End">
					<bucket class="java.lang.String">
						<bucketExpression><![CDATA[$F{gender}]]></bucketExpression>
					</bucket>
					<crosstabColumnHeader>
						<cellContents backcolor="#F0F8FF" mode="Opaque">
							<box>
								<pen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
							</box>
							<textField>
								<reportElement uuid="28c256f9-05c4-451f-b59c-f6ef43b03456" style="Crosstab Data Text" x="0" y="0" width="50" height="30"/>
								<textElement/>
								<textFieldExpression><![CDATA[$V{gender}]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabColumnHeader>
					<crosstabTotalColumnHeader>
						<cellContents backcolor="#BFE1FF" mode="Opaque">
							<box>
								<pen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
							</box>
							<staticText>
								<reportElement uuid="281e7746-2131-4832-95be-76ca5f81c03e" x="0" y="0" width="50" height="30"/>
								<textElement textAlignment="Center" verticalAlignment="Middle"/>
								<text><![CDATA[Total gender]]></text>
							</staticText>
						</cellContents>
					</crosstabTotalColumnHeader>
				</columnGroup>
				<measure name="ageGroupMeasure" class="java.lang.Integer" calculation="Count">
					<measureExpression><![CDATA[$F{ageGroup}]]></measureExpression>
				</measure>
				<crosstabCell width="50" height="25">
					<cellContents>
						<box>
							<pen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
						</box>
						<textField>
							<reportElement uuid="651f6f27-f615-4455-b60c-8ca4393612ec" style="Crosstab Data Text" x="0" y="0" width="50" height="25"/>
							<textElement/>
							<textFieldExpression><![CDATA[$V{ageGroupMeasure}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell height="25" rowTotalGroup="ageGroup">
					<cellContents backcolor="#BFE1FF" mode="Opaque">
						<box>
							<pen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
						</box>
						<textField>
							<reportElement uuid="d5f65799-2a72-4a2f-a05f-4e52efb5b26c" style="Crosstab Data Text" x="0" y="0" width="50" height="25"/>
							<textElement/>
							<textFieldExpression><![CDATA[$V{ageGroupMeasure}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="50" columnTotalGroup="gender">
					<cellContents backcolor="#BFE1FF" mode="Opaque">
						<box>
							<pen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
						</box>
						<textField>
							<reportElement uuid="4df1738b-d821-4813-9a1e-be3c458f21dd" style="Crosstab Data Text" x="0" y="0" width="50" height="25"/>
							<textElement/>
							<textFieldExpression><![CDATA[$V{ageGroupMeasure}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell rowTotalGroup="ageGroup" columnTotalGroup="gender">
					<cellContents backcolor="#BFE1FF" mode="Opaque">
						<box>
							<pen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
						</box>
						<textField>
							<reportElement uuid="70f2245f-fdab-4168-9294-83ee5d8503a3" style="Crosstab Data Text" x="0" y="0" width="50" height="25"/>
							<textElement/>
							<textFieldExpression><![CDATA[$V{ageGroupMeasure}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
			</crosstab>
		</band>
	</summary>
</jasperReport>
